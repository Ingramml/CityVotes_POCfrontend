<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CityVotes - Santa Ana City Council Voting Records</title>
    <meta name="description" content="Track Santa Ana City Council voting records, member alignment, and civic transparency data.">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/santa-ana.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-sa-blue">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-vote-yea me-2"></i>CityVotes
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="index.html">
                            <i class="fas fa-home me-1"></i>Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="council.html">
                            <i class="fas fa-users me-1"></i>Council
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="meetings.html">
                            <i class="fas fa-calendar me-1"></i>Meetings
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="votes.html">
                            <i class="fas fa-check-square me-1"></i>Votes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="agenda-search.html">
                            <i class="fas fa-search me-1"></i>Search
                        </a>
                    </li>
                </ul>
                <span class="navbar-text text-sa-gold">
                    <i class="fas fa-map-marker-alt me-1"></i>Santa Ana
                </span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="hero-section py-5">
        <div class="container text-center">
            <h1 class="display-4 mb-3">
                <i class="fas fa-landmark me-3"></i>Santa Ana City Council
            </h1>
            <p class="lead text-muted">Voting Records & Transparency</p>
        </div>
    </header>

    <!-- Stats Section -->
    <section class="py-4 bg-light">
        <div class="container">
            <div class="row text-center" id="statsRow">
                <div class="col-md-3 col-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-value" id="totalVotes">--</div>
                        <div class="stat-label">Total Votes</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-value" id="totalMeetings">--</div>
                        <div class="stat-label">Meetings</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-value" id="passRate">--%</div>
                        <div class="stat-label">Pass Rate</div>
                    </div>
                </div>
                <div class="col-md-3 col-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-value" id="unanimousRate">--%</div>
                        <div class="stat-label">Unanimous</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container my-5">
        <!-- Council Members Section -->
        <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-users me-2"></i>City Council</h2>
                <a href="council.html" class="btn btn-outline-primary">View All</a>
            </div>
            <div class="row" id="councilGrid">
                <div class="col-12 text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Meetings Section -->
        <section class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-calendar me-2"></i>Recent Meetings</h2>
                <a href="meetings.html" class="btn btn-outline-primary">View All</a>
            </div>
            <div class="list-group" id="recentMeetings">
                <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Voting Alignment Section -->
        <section class="mb-5">
            <h2 class="mb-4"><i class="fas fa-handshake me-2"></i>Voting Alignment</h2>
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-success text-white">
                            <i class="fas fa-thumbs-up me-2"></i>Most Aligned
                        </div>
                        <div class="card-body" id="mostAligned">
                            <div class="text-center py-3">
                                <div class="spinner-border text-success" role="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-warning text-dark">
                            <i class="fas fa-balance-scale me-2"></i>Least Aligned
                        </div>
                        <div class="card-body" id="leastAligned">
                            <div class="text-center py-3">
                                <div class="spinner-border text-warning" role="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <h6>CityVotes - Santa Ana Voting Transparency</h6>
                    <p class="text-muted mb-0">
                        Data sourced from official Santa Ana city council meeting records.
                    </p>
                </div>
                <div class="col-md-4 text-end">
                    <span class="text-muted" id="dateRange">2024 Data</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Static Data API -->
    <script src="js/api.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        await Promise.all([
            loadStats(),
            loadCouncil(),
            loadRecentMeetings(),
            loadAlignment()
        ]);
    });

    async function loadStats() {
        try {
            const data = await CityVotesAPI.getStats();

            if (data.success) {
                document.getElementById('totalVotes').textContent = data.stats.total_votes.toLocaleString();
                document.getElementById('totalMeetings').textContent = data.stats.total_meetings;
                document.getElementById('passRate').textContent = data.stats.pass_rate + '%';
                document.getElementById('unanimousRate').textContent = data.stats.unanimous_rate + '%';

                if (data.stats.date_range.start && data.stats.date_range.end) {
                    document.getElementById('dateRange').textContent =
                        `${formatDate(data.stats.date_range.start)} - ${formatDate(data.stats.date_range.end)}`;
                }
            }
        } catch (error) {
            console.error('Error loading stats:', error);
            document.getElementById('statsRow').innerHTML = `
                <div class="col-12">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Unable to load stats.
                    </div>
                </div>
            `;
        }
    }

    async function loadCouncil() {
        try {
            const data = await CityVotesAPI.getCouncil();

            if (data.success) {
                const grid = document.getElementById('councilGrid');
                grid.innerHTML = data.members.map(member => `
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                        <div class="card council-card h-100">
                            <div class="card-body text-center">
                                <div class="council-avatar mb-3">
                                    <i class="fas fa-user-circle fa-3x text-sa-blue"></i>
                                </div>
                                <h5 class="card-title mb-1">${member.full_name}</h5>
                                <div class="mb-2">
                                    ${member.is_current ? '<span class="badge bg-success">Current</span>' : '<span class="badge bg-secondary">Former</span>'}
                                </div>
                                <p class="text-muted small mb-2">${member.position || 'Council Member'}</p>
                                <div class="d-flex justify-content-around small">
                                    <span class="text-success" title="Aye votes">
                                        <i class="fas fa-check"></i> ${member.stats.aye_percentage}%
                                    </span>
                                    <span class="text-primary" title="Participation">
                                        <i class="fas fa-chart-line"></i> ${member.stats.participation_rate}%
                                    </span>
                                </div>
                                <a href="council-member.html?id=${member.id}" class="btn btn-sm btn-outline-primary mt-3">
                                    View Profile
                                </a>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        } catch (error) {
            console.error('Error loading council:', error);
            document.getElementById('councilGrid').innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger">Failed to load council members</div>
                </div>
            `;
        }
    }

    async function loadRecentMeetings() {
        try {
            const data = await CityVotesAPI.getMeetings();

            if (data.success) {
                const list = document.getElementById('recentMeetings');
                // Get 5 most recent meetings
                const recentMeetings = data.meetings.slice(0, 5);
                list.innerHTML = recentMeetings.map(meeting => `
                    <a href="meeting-detail.html?id=${meeting.id}" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                            <div>
                                <h6 class="mb-1">
                                    <i class="fas fa-calendar-day me-2 text-primary"></i>
                                    ${formatDate(meeting.meeting_date)}
                                </h6>
                                <small class="text-muted">${meeting.meeting_type} Meeting</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-primary">${meeting.vote_count} votes</span>
                                <div class="small text-muted">${meeting.agenda_item_count || meeting.vote_count} items</div>
                            </div>
                        </div>
                        <div class="mt-2">
                            ${meeting.agenda_url ? '<span class="badge bg-secondary me-1"><i class="fas fa-file-alt"></i> Agenda</span>' : ''}
                            ${meeting.minutes_url ? '<span class="badge bg-secondary me-1"><i class="fas fa-file-lines"></i> Minutes</span>' : ''}
                            ${meeting.video_url ? '<span class="badge bg-danger me-1"><i class="fas fa-video"></i> Video</span>' : ''}
                        </div>
                    </a>
                `).join('');
            }
        } catch (error) {
            console.error('Error loading meetings:', error);
            document.getElementById('recentMeetings').innerHTML = `
                <div class="alert alert-danger">Failed to load meetings</div>
            `;
        }
    }

    async function loadAlignment() {
        try {
            const data = await CityVotesAPI.getAlignment();

            if (data.success) {
                // Most aligned
                const mostAligned = document.getElementById('mostAligned');
                mostAligned.innerHTML = data.most_aligned.map(pair => `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div>
                            <strong>${pair.member1}</strong> & <strong>${pair.member2}</strong>
                        </div>
                        <span class="badge bg-success">${pair.agreement_rate}%</span>
                    </div>
                `).join('');

                // Least aligned
                const leastAligned = document.getElementById('leastAligned');
                leastAligned.innerHTML = data.least_aligned.map(pair => `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div>
                            <strong>${pair.member1}</strong> & <strong>${pair.member2}</strong>
                        </div>
                        <span class="badge bg-warning text-dark">${pair.agreement_rate}%</span>
                    </div>
                `).join('');
            }
        } catch (error) {
            console.error('Error loading alignment:', error);
        }
    }

    function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    }
    </script>
</body>
</html>
